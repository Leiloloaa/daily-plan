/*
 * @Author: Leiloloaa 
 * @Date: 2021-11-14 11:15:30 
 * @Last Modified by: Leiloloaa
 * @Last Modified time: 2021-11-14 12:07:27
 */

# ç¬¬äº”å…³

> è¿™å‘¨ä¸»è¦æ˜¯æ·±å…¥çš„æ¢ç´¢äº† javascript çš„ä¸€äº›åº•å±‚æ€§çš„ä¸œè¥¿ï¼Œä¾‹å¦‚æ‰‹å†™ èŠ‚æµã€é˜²æŠ– å’Œ callã€applyå’Œbind ä»¥åŠ instanceof çš„å®ç°ã€‚åœ¨è§†é‡æ‰©å¤§ä¹‹åï¼Œè¦å­¦ä¼šå»æ€è€ƒåº•å±‚æ€§çš„åŸç†ï¼Œé¢è¯•å®˜å¸¸è€ƒçš„é¢˜æ˜¯æ²¡é”™çš„ï¼Œå› ä¸ºçœ‹ä½ å®ç°ä¸€ä¸ªç‚¹ï¼Œå°±èƒ½å¼•å¸¦å‡ºå¾ˆå¤šå…¶ä»–çš„çŸ¥è¯†ç‚¹ã€‚çœ‹ä¼¼å­¤ç«‹ï¼Œå…¶å®éƒ½æ˜¯ç›¸å…³è”çš„ï¼

**å‰¯æœ¬æ€ª**

- Object å’Œ Reflect
- this å’Œç®­å¤´å‡½æ•°
- é—­åŒ…çš„ç”¨å¤„
- Map å’Œ Set
- Promise çš„ç”¨æ³•
- èŠ‚æµå’Œé˜²æŠ–
- æ‰‹å†™å®ç° callã€apply å’Œ bind

æ¥ä¸‹æ¥ï¼Œå’±ä»¬å°±ä¸€ä¸ªä¸ªçš„å¤ä¹ ç”¨å¤„ï¼Œè¦å»ºç«‹ js çŸ¥è¯†ç³»ç»Ÿè„‘å›¾ï¼Œå­¦æ¯ä¸ªç‚¹çš„æ—¶å€™ï¼Œè¦æƒ³ç€è¿™å¯¹å…¨å±€ä¼šæœ‰ä»€ä¹ˆå½±å“ã€‚

## Object å’Œ Reflect

> æ€»ä¹‹ä¸€å¥è¯ï¼šReflect å°±æ˜¯ Objectï¼ŒReflect ä¿®æ”¹äº† Object çš„ä¸€äº›å‘½ä»¤ï¼Œè®©å…¶å˜æˆäº†å‡½æ•°è¡Œä¸ºï¼ŒåŒæ—¶ä¿®æ”¹äº† Object çš„ä¸€äº›è¿”å›å€¼ã€‚

ä¸¾ä¸ªğŸŒ°

```js
// è·å–å€¼
obj.['xxx']
obj.xxx
// reflect
Reflect.get(target,xxx)
// åˆ é™¤å€¼
delete obj.xxx
// reflect
Reflect.deleteProperty(target,xxx)
// æ˜¯å¦å­˜åœ¨
xxx in obj
// reflect
Reflect.has(target,xxx)
// ç­‰ç­‰
```

ä¿®æ”¹è¿”å›å€¼æ–¹é¢ï¼š`Object.defineProperty(obj, name, desc)`åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€Œ`Reflect.defineProperty(obj, name, desc)`åˆ™ä¼šè¿”å›`false`

## this ä¸ ç®­å¤´å‡½æ•°

> JavaScript ä¸­çš„ this å’Œåˆ«çš„è¯­è¨€çš„ this ä¸å¤ªä¸€æ ·ï¼Œjs ä¸­çš„ this çš„å€¼è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šï¼Œå¹¶ä¸” this æ°¸è¿œæŒ‡å‘è°ƒç”¨å®ƒçš„å‡½æ•°ã€‚

ç®­å¤´å‡½æ•°

- æ²¡æœ‰ this
- æ²¡æœ‰ arguments
- å¦‚æœä½¿ç”¨ this ä¼šå»æŸ¥æ‰¾ä¸Šå±‚å‡½æ•° this æˆ–è€…æ˜¯ arguments

```js
function foo(num) {
    return (...rest) => {
        // ç®­å¤´å‡½æ•°æ²¡æœ‰ this arguments
        // æ‰€ä»¥ä¼šå»æ‰¾ä¸Šå±‚å‡½æ•°çš„ arguments
        // console.log(arguments[0]);
        //å¦‚æœä¸€å®šè¦ä¼  å¯ä»¥ä½¿ç”¨ æ‰©å±•è¿ç®—ç¬¦
        console.log(rest);
    }
}
var bar = foo(123)
bar(456)
function bzz(num) {
    return function() {
        console.log(arguments[0]);
    }
}
var baz = bzz()
baz() // è¿™ç§æƒ…å†µå°±æ˜¯ undefined
baz(123) // 123
```

## é—­åŒ…çš„ç”¨å¤„

é—­åŒ…çš„å®šä¹‰ï¼šæœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°

é—­åŒ…çš„ç”¨å¤„ä¹‹ä¸€ï¼šä¿æŠ¤ç§æœ‰å˜é‡ä¸ä¼šè¢«éšæ„çš„ä¿®æ”¹ï¼ˆå¾ˆå¤š js åº“é‚£äº›é¡¶å±‚å˜é‡éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼‰

```js
// é—­åŒ…çš„æ¦‚å¿µï¼šæœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸçš„ä¸­çš„å˜é‡
// äº§ç”Ÿé—­åŒ…çš„åŸå› ï¼š1ã€return ä¸€ä¸ªå‡½æ•° 2ã€è‡ªæ‰§è¡Œå‡½æ•° 3ã€for å¾ªç¯ä¸­æœ‰å®šæ—¶å™¨ 4ã€èŠ‚æµå’Œé˜²æŠ– 5ã€å›è°ƒå‡½æ•° 6ã€å‡½æ•°ä½œä¸ºå‚æ•° 7ã€æŸ¯é‡ŒåŒ–
// å·§ç”¨é—­åŒ…
function test() {
    const data = {}
    return {
        set(key, value) {
            data[key] = value
        },
        get(key) {
            return data[key]
        }
    }
}
// åœ¨å¾ˆå¤šåº“ä¸­ï¼Œéƒ½ä¼šä½¿ç”¨é—­åŒ…ï¼Œä¿è¯ç”¨æˆ·ä¸å¯ä»¥éšä¾¿çš„æ›´æ”¹å…¨å±€å˜é‡
// æœ¬ä¾‹ä¸­çš„ data ä¾¿åªå¯ä»¥é€šè¿‡ set èµ‹å€¼ï¼Œget å–å€¼ï¼Œä¸ä¼šç›´æ¥ä¿®æ”¹
const bar = test()
bar.set('name', 'zs')
console.log(bar.get('name'));
```

## Map å’Œ Set

Map çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³ Object ä¸­ key çš„é™åˆ¶åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ Map ä¸­çš„ key å°±å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å¯¹è±¡æˆ–è€…æ˜¯ Symbolï¼›Set ç±»ä¼¼æ•°ç»„ï¼Œå…¶æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ¯ä¸€é¡¹éƒ½æ˜¯å”¯ä¸€çš„ã€‚

- WeakMap
  - Weak æ˜¯è™šå¼±çš„æ„æ€
  - WeakMap çš„ key ä¸€å®šè¦æ˜¯å¯¹è±¡ï¼Œå¦‚æœæ˜¯å…¶ä»–çš„ å˜é‡ æˆ–è€…æ˜¯ Symbol éƒ½ä¼šæŠ¥é”™
  - WeakMap çš„ key ä¸è®¡å…¥åƒåœ¾å›æ”¶ï¼Œå› ä¸ºæ˜¯å¼±å¼•ç”¨ï¼Œä¸€æ—¦å¤–ç•Œçš„å¼•ç”¨æ¶ˆå¤±äº†ï¼Œè¿™ä¸ª key å°±ä¼šè‡ªåŠ¨æ¸…é™¤ï¼Œè¿™å°±æ˜¯ WeakMap çš„æ„æ€
  - WeakMap æ²¡æœ‰ sizeï¼Œå¹¶ä¸”ä¸å¯ä»¥éå†ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“ key ä»€ä¹ˆæ—¶å€™ä¼šæ¸…é™¤ï¼Œå®ƒåªæœ‰ getã€setã€has å’Œ delete æ–¹æ³•
- Map
  - Map çš„å‡ºç°æ˜¯ä¸ºäº†åŠ å¼º Object åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸è¶³ï¼Œä¾‹å¦‚ Object çš„ key åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œ Map çš„ key å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€å¯¹è±¡æˆ–è€… Symbol ç­‰
  - Map ä¸­æœ‰ sizeï¼Œå¹¶ä¸”è¿˜æœ‰ clear æ–¹æ³•
  - Map å†…éƒ¨éƒ¨ç½²äº† Iterate æ˜¯å¯ä»¥éå†çš„ï¼Œmap.keys()ã€map.values()ã€maps.entires()
- Set
  - Set ç±»ä¼¼æ•°ç»„ï¼Œä½†æ˜¯å®ƒå†…éƒ¨çš„å€¼æ˜¯å”¯ä¸€çš„
    - è¿™ç‚¹ç‰¹æ€§å¯ä»¥ç”¨äºæ•°ç»„çš„å»é‡ [...new Set(arr)]
  - Set æ˜¯ä½¿ç”¨ add æ–¹æ³•è¿›è¡Œæ·»åŠ 

> Vue3 çš„æ”¶é›†ä¾èµ–å’Œè§¦å‘ä¾èµ–çš„ä¾æ®æ˜¯å®ç°äº†ä¸€ä¸ª WeakMap æ”¶é›†æ‰€æœ‰çš„  reactive å¯¹è±¡ï¼Œå¹¶ä¸”å°†å…¶è®¾ç½®ä¸º keyï¼Œè¿™ä¸ª key åˆæ˜¯ä¸€ä¸ª Map é›†åˆï¼Œæ”¶é›†ç€å®ƒæ‰€æœ‰çš„å±æ€§ã€‚ç„¶åå†å®ç°äº†ä¸€ä¸ª Set æ”¶é›†æ‰€æœ‰å±æ€§çš„ fnï¼Œè¿™ä¸ª fn å°±æ˜¯ä¿®æ”¹å±æ€§çš„å‡½æ•°ã€‚

## Promise çš„ç”¨æ³•

```js
// promise æœ‰ä¸‰ç§çŠ¶æ€ pending(å¾…å®šçš„) fulfilled(æ»¡è¶³çš„) rejected(å¤±è´¥çš„)
const p1 = new Promise((resolved, rejected) => {
    // æ‰§è¡Œäº† resolved() çŠ¶æ€å°±å˜æˆäº† fulfilled
    // resolved()
    // æ‰§è¡Œäº† rejected() çŠ¶æ€å°±å˜æˆäº† rejected å¹¶ä¸”ä¼šæŠ¥é”™
    // rejected()
    // ä¸¤ä¸ªæ–¹æ³•éƒ½æ¯æ‰§è¡Œçš„è¯ï¼Œå°±æ˜¯ç­‰å¾…çŠ¶æ€
})
console.log('p1', p1);
const p2 = new Promise(function test(resolve, reject) {
    var timeOut = Math.random() * 2;
    // console.log('set timeout to: ' + timeOut + ' seconds.');
    setTimeout(function() {
        if (timeOut < 1) {
            // console.log('call resolve()...');
            resolve('200 OK');
        } else {
            // console.log('call reject()...');
            reject('500 timeout');
        }
    }, timeOut * 1000);
}).then((res) => {
    console.log('res:', res);
}).catch((err) => {
    console.log('err:', err);
})
```

## èŠ‚æµå’Œé˜²æŠ–

- èŠ‚æµ
  - é¢‘ç¹çš„è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ä¸€æ®µäº‹ä»¶å†…åªè§¦å‘ä¸€æ¬¡
- é˜²æŠ–
  - é¢‘ç¹çš„è§¦å‘ä¸€ä¸ªäº‹ä»¶ï¼Œåœ¨ä¸€æ®µäº‹ä»¶å†…åªè§¦å‘æœ€åä¸€æ¬¡

```js
// èŠ‚æµå‡½æ•° - åƒæˆ‘ä»¬ä¹˜ååœ°é“ï¼Œé“é—¸æ‰“å¼€çš„æ—¶é—´æ˜¯å›ºå®šçš„
// éœ€è¦ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œå¦‚æœä¹‹å‰å­˜åœ¨ã€‚é‚£ä¹ˆå°±ç›´æ¥ return
// å¦åˆ™å°±é‡æ–°è®¾ç½®å®šæ—¶å™¨ï¼Œå¹¶ä¸”æ¸…ç©ºä¹‹å‰çš„ timer
function throttle(fn, delay) {
    let timer = null
    return function() {
        if (timer) return
        timer = setTimeout(() => {
            fn()
            timer = null
        }, delay);
    }
}
// é˜²æŠ–å‡½æ•° - åƒæˆ‘ä»¬ä¹˜åå…¬äº¤ï¼Œå¸æœºå…³é—¨çš„æ—¶é—´æ˜¯æ ¹æ®æœ€åä¸€ä¸ªä¹˜å®¢ä¸Šè½¦çš„æ—¶é—´
// æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ—¶å™¨ä¼šé‡æ–°è®¡æ—¶
function debounce(fn, delay) {
    let timer = null
    return function() {
        if (timer) {
            clearTimeout(timer)
        }
        timer = setTimeout(() => {
            fn()
        }, delay);
    }
}
```

## æ‰‹å†™ callã€apply å’Œ bind

```js
// call
// å…ˆåˆ¤æ–­ä¼ å…¥ context çš„ç±»å‹ï¼Œå†ç»™ context æ·»åŠ å‡½æ•°ï¼Œå†ä¼ å…¥å‚æ•°è¿è¡Œå‡½æ•°ï¼Œå†åˆ é™¤å‡½æ•°ï¼Œæœ€åå†è¿”å›ç»“æœ
Function.prototype.call = function(context) {
    context = context ? Object(context) : window
    context.fn = this
    let args = [...arguments].slice(1)
    let result = context.fn(...args)
    delete context.fn
    return result
};
// apply
// å®ç°æ­¥éª¤å’Œ call ç±»ä¼¼ï¼Œåªæ˜¯è¯´è¦åˆ¤æ–­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦æ˜¯æ•°ç»„
Function.prototype.apply = function(context, arr) {
    context = context ? Object(context) : window
    context.fn = this
    let result
    if (!arr) {
        result = context.fn()
    } else {
        result = context.fn(...arr)
    }
    delete context.fn
    return result
};
// bind
// bind æœ‰ç‚¹ç‰¹æ®Šï¼Œå› ä¸ºå®ƒæ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥ æŸ¯é‡ŒåŒ–ä¼ å‚
// é¦–å…ˆå¿…é¡»ä¿è¯è°ƒç”¨å®ƒçš„ æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå†ç»‘å®šä¸Šä¸‹æ–‡ thisï¼Œç„¶åä¼ å‚ï¼Œç„¶åè¿”å›ä¸€ä¸ª å‡½æ•°ï¼Œè¿˜å¯ä»¥æ¥å—å‡½æ•°ï¼Œå†è°ƒç”¨ apply
Function.prototype.bind = function(context) {
    if (typeof this !== 'function') {
        throw new Error('this is not function')
    }
    let self = this
    let args = [...arguments].slice(1)
    return function() {
        let bindArgs = [...arguments].slice(1)
        return self.apply(context, args.concat(bindArgs))
    }
}
```

call å’Œ apply çš„åŒºåˆ«å°±æ˜¯å‰è€…æ˜¯æ¥æ”¶ä¸€ä¸ªå‚æ•°åˆ—è¡¨ ï¼Œè€Œåè€…æ˜¯æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼›äºŒè€…éƒ½æ˜¯ç«‹å³æ‰§è¡Œ

bind æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œå¯ä»¥æŸ¯é‡ŒåŒ–ä¼ å‚